<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Tushar's personal blog"><title>Pipes in Linux | Tushar | Blog</title><link rel="stylesheet" type="text/css" href="/blog//css/normalize.css"><link rel="stylesheet" type="text/css" href="/blog//css/highlight.css"><link rel="stylesheet" type="text/css" href="/blog//css/very-simple.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/blog/favicon.ico"><link rel="alternate" type="application/atom+xml" href="/blog/atom.xml"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/blog/." class="title">Tushar | Blog</a><span class="subtitle"></span><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="/blog/" class="sidebar-nav-item">Home</a><a href="/blog/archives" class="sidebar-nav-item">Archives</a></div></nav><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>Pipes in Linux</h1></div></div><div class="wrapper"><div class="container meta"><div class="post-time">2016-08-13</div><div class="post-tags"><a class="post-tag-link" href="/blog/tags/Linux/">Linux</a>/<a class="post-tag-link" href="/blog/tags/Pipes/">Pipes</a>/<a class="post-tag-link" href="/blog/tags/Python/">Python</a></div></div></div><article><div class="container post"><p>In this blog, I’d like to share about <a href="https://en.wikipedia.org/wiki/Pipeline_(Unix" target="_blank" rel="external">Pipes</a> - an interesting feature of Unix/Linux operating systems (it’s available in other systems too). Having talked about Pipes in brief, I will do the implementation in Python. So let’s get started!</p>
<h3 id="Pipe"><a href="#Pipe" class="headerlink" title="Pipe"></a>Pipe</h3><h6 id="Brief-History"><a href="#Brief-History" class="headerlink" title="Brief History"></a>Brief History</h6><p>Pipes are the eldest IPC tools and were introduced by <a href="https://en.wikipedia.org/wiki/Douglas_McIlroy" target="_blank" rel="external">Douglas McIlroy</a> after he noticed that most of the time they were processing the output of one process as the input to another. Later, <a href="https://en.wikipedia.org/wiki/Ken_Thompson" target="_blank" rel="external">Ken Thompson</a> added the concept of pipes to the UNIX operating system.</p>
<h6 id="About"><a href="#About" class="headerlink" title="About"></a>About</h6><p>In simple terms, a <em>pipe</em> is a method of connecting the standard output of one process to the standard input of another. A quick example:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ls . | sort</div></pre></td></tr></table></figure></p>
<p>In the above shell command (reading from left to right), we are passing the output from <code>ls</code> command as an input to <code>sort</code> command. The combined output is a current directory’s content in a sorted order. The vertical bar ( <code>|</code> ) is a pipe character. It acts as a method of one-way communications (or half-duplex) between processes.</p>
<p>They are of basically two types : <strong>Anonymous Pipes</strong> and <strong>Named Pipes</strong> (FIFO).</p>
<p>The one we just saw, was an <em>anonymous pipe</em> or <em>half-duplex pipe</em>.</p>
<h6 id="Pipe-creation"><a href="#Pipe-creation" class="headerlink" title="Pipe creation"></a>Pipe creation</h6><p>When a process creates a pipe, the kernel sets up two file descriptors (read and write) for use by the pipe. A pipe initially connects a process to itself and any data traveling through the pipe moves through the kernel. Under Linux, pipes are actually represented internally with a valid <a href="https://en.wikipedia.org/wiki/Inode" target="_blank" rel="external">inode</a> which resides within the kernel itself, and not within the bounds of any physical file system. Well, you might question, what’s the point of pipe if they connect a process to itself. Are they just going to communicate with itself? Well, the answer is no. Pipes are useful in case when we fork a child process and as we know a child process inherits any open file descriptors from parent, allowing us to setup a multiprocess communication (in this case between child and parent process). As both the processes have access to file descriptors, a pipeline is setup.</p>
<p>One important thing we should note that, since the pipe resides within the confines of the kernel, any process that is not in the ancestry for the creator of the pipe has no way of addressing it. This is not the case with named pipes (FIFOS), which we will discuss next.</p>
<h6 id="Named-Pipes"><a href="#Named-Pipes" class="headerlink" title="Named Pipes"></a>Named Pipes</h6><p>Unlike anonymous pipes, a named pipe exists in the file system. After input-output has been performed by the sharing processes, the pipe still exists in the file system independently of the process, and can be used for communication between some other processes.<br>We can create a named pipes either using <code>mkfifo</code> or <code>mknod</code> shell commands (Python has an inbuilt method which we will see during implementations).<br>Just like a regular file, we can set file permissions on a named pipe. Checkout mode from <code>man mkfifo</code>.<br>A quick example of named pipes that we might have often come across.<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat &lt;(ls -li)</div></pre></td></tr></table></figure></p>
<p>Here, the output from <code>ls -li</code> is redirected to a temporary named pipe, which shell creates, names and later deletes. Another fun example is to create a very basic shared terminal. Let’s try it out.<br>The idea is to create a named pipe and then use two separate <code>cat</code> process to read/write data from/to the named pipe.</p>
<ul>
<li><p>Creating a named pipe (from console) :</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkfifo named_pipe_file_name <span class="comment"># create a named pipe</span></div><div class="line"><span class="comment"># or</span></div><div class="line">mknod named_pipe_file_name p</div></pre></td></tr></table></figure>
<p>If you observer closely the output from <code>ls -l</code> looks like:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">prw-r--r--. 1 tushar tushar 0 Aug 13 05:32 named_pipe_file_name|</div></pre></td></tr></table></figure>
</li>
</ul>
<p>You may have noticed an additional <code>|</code> character is shown next to <code>named_pipe_file_name</code> and the file permission starts with <code>p</code>. This is a Linux clue that the <code>named_pipe_file_name</code> is a pipe.</p>
<ul>
<li><p>Using it:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cat &lt;named_pipe_file_name <span class="comment"># read</span></div><div class="line"><span class="comment"># Run the next command in a separate terminal instance.</span></div><div class="line">cat &gt;named_pipe_file_name <span class="comment"># write</span></div><div class="line"><span class="comment"># Now type your heart out! :)</span></div></pre></td></tr></table></figure>
<p>You might notice that after the first command the execution appears to be blocked. This happens because the other end of the pipe is not yet connected, and so the kernel suspends the first process until the second process opens the pipe.</p>
</li>
</ul>
<p>I hope that was a very simple usage of named pipes and helped you understand named pipes.</p>
<p>Now (for fun), let’s implement pipes in Python. Since the code is in Python, I need not explain every line from the code. It should be readable. :)<br>The basic idea is to create two processes (parent and child) and let parent read the data written by child process.</p>
<h6 id="Implementation-in-Python2-7"><a href="#Implementation-in-Python2-7" class="headerlink" title="Implementation in Python2.7"></a>Implementation in Python2.7</h6><ul>
<li><p>Anonymous pipe</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">child</span><span class="params">(pipeout)</span>:</span></div><div class="line">  <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">      time.sleep(<span class="number">1</span>)</div><div class="line">      os.write(pipeout, <span class="string">"Hello from child!"</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">parent</span><span class="params">()</span>:</span></div><div class="line">    <span class="comment"># The two file descriptors.</span></div><div class="line">    pipein, pipeout = os.pipe()</div><div class="line">    <span class="string">"""</span></div><div class="line">      Note: The pipe() call must be made before a call</div><div class="line">      to fork or the descriptors will not be inherited</div><div class="line">      by the child.</div><div class="line">     """</div><div class="line">    <span class="keyword">if</span> os.fork() == <span class="number">0</span>:</div><div class="line">        child(pipeout)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">            msg = os.read(pipein, <span class="number">128</span>)</div><div class="line">            print(<span class="string">'Parent &#123;&#125; got &#123;&#125; at &#123;&#125;'</span>.format(os.getpid(),</div><div class="line">                                                  msg,</div><div class="line">                                                  time.time())</div><div class="line"></div><div class="line">parent()</div></pre></td></tr></table></figure>
</li>
<li><p>Named pipe</p>
<p>The implementation is almost similar except the fact that instead of descriptors, we have access to named pipe file name and we use it to perform I/O operations.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os, time, sys</div><div class="line">pipe_name = <span class="string">'named_pipe_file_name'</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">child</span><span class="params">()</span>:</span></div><div class="line">    <span class="comment"># Note the same file name is being used for I/O.</span></div><div class="line">    pipeout = os.open(pipe_name, os.O_WRONLY)</div><div class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">        time.sleep(<span class="number">1</span>)</div><div class="line">        os.write(pipeout, <span class="string">'Hello from child!\n'</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">parent</span><span class="params">()</span>:</span></div><div class="line">    pipein = open(pipe_name, <span class="string">'r'</span>)</div><div class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">        msg = pipein.readline()[:<span class="number">-1</span>]</div><div class="line">        <span class="keyword">print</span> <span class="string">'Parent %d got "%s" at %s'</span> % (os.getpid(),</div><div class="line">                                            msg,</div><div class="line">                                            time.time( ))</div><div class="line"></div><div class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(pipe_name):</div><div class="line">    os.mkfifo(pipe_name) <span class="comment"># Creates a file on disk.</span></div><div class="line"></div><div class="line">pid = os.fork()</div><div class="line"><span class="keyword">if</span> pid != <span class="number">0</span>:</div><div class="line">    parent()</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    child()</div></pre></td></tr></table></figure>
</li>
</ul>
<p>Phew! That was fun!</p>
<p>Cheers!</p>
</div><!-- comment system--><div class="container"><hr><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'gtushar';
var disqus_identifier = '2016/08/13/Pipes-in-Linux/';
var disqus_title = 'Pipes in Linux';
var disqus_url = 'http://gtushar.co/blog/blog/2016/08/13/Pipes-in-Linux/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="mailto:tushar.rishav@gmail.com" target="_blank"><i class="fa fa-envelope-o"></i></a><a href="http://twitter.com/tushar_rishav" target="_blank"><i class="fa fa-twitter"></i></a><a href="https://github.com/tushar-rishav" target="_blank"><i class="fa fa-github"></i></a><a href="/blog/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div><div class="footer">© 2016 <a href="/" rel="nofollow">Tushar | Blog</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/very-simple">very-simple</a>.</div></div></div></footer><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
e=o.createElement(i);r=o.getElementsByTagName(i)[0];
e.src='//www.google-analytics.com/analytics.js';
r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-77419685-1');ga('send','pageview');</script></html>